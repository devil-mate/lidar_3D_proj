<launch>
    <arg name="id_robot" default="robot"/>
  <!-- Arguments -->
  <arg name="model" default="burger" doc="model type [burger, waffle, waffle_pi]"/>
  <arg name="map_file" default="$(find sxl_localization)/maps/empty/map_empty.yaml"/>
  <arg name="rvizConfig" default="$(find tv_navigation)/rviz/navigationtest.rviz" />
  <!-- <arg name="rvizConfig" default="$(find tv_navigation)/rviz/navigationsxl.rviz" /> -->
  <!-- <arg name="rvizConfig" default="$(find tv_navigation)/rviz/navigation.rviz" /> -->

  <arg name="perRviz_open" default="false"/>
  <arg name="move_forward_only" default="false"/>
  <arg name="locateMethod" default="false"/>
  <arg name="dataFusion" default="true"/> 
  <!-- 定位方式 -->
  <arg name="use_static_map" default="false"/> 
  <arg name="launch_amcl" default="false"/> 
  <arg name="launch_vslam" default="false"/> 
  <arg name="launch_slam" default="true"/> 
  <!-- 融合 -->

  <arg name="cmdGUI" default="false"/>
  <arg name="laser_filtered_topic" default="$(optenv ROBOT_LOCALIZATION_SCAN_TOPIC scan_filtered)"/> <!-- laser  for slam movebase -->
  <arg name="slam_methods" default="gmapping" doc="slam type [gmapping, cartographer, hector, karto, frontier_exploration]"/>
  <arg name="configuration_basename" default="turtlebot3_lds_2d.lua"/>
  
  <arg name="launch_robot_sxl" default="true"/>
  <arg name="launch_robot_t3" default="true"/>

  <arg name="prefix" default="robot"/>
  <arg name="config_prefix" default="sxl"/>


  

  <!-- temp -->
  <arg name="imuodom_topic_pub" default="odometry/filtered_imuodom"/>
  <arg name="gpsodom_topic_pub" default="odometry/filtered_gpsodom"/>
  <!-- move base ? -->
    <arg name="odom_filter_topic" default="$(arg imuodom_topic_pub)"/>
  <!-- <group if ="$(arg launch_robot_sxl)">

    <arg name="prefix" default="robot"/>
    <arg name="odom_frame" default="$(arg prefix)_odom"/>
    <arg name="base_frame" default="$(arg prefix)_base_footprint"/>
    <arg name="map_frame" default="$(arg prefix)_map"/>
    <arg name="world_frame" default="$(arg prefix)_map"/> 

    <arg name="laser_raw_topic" default="front_laser/scan"/> 
    <arg name="imu_raw_data" default="imu/data_raw" />
    <arg name="imu_raw_mag" default="mavros/imu/mag" />
    <arg name="odom_raw_topic" default="robotnik_base_control/odom" />
    <arg name="gps_raw" default="gps/NavSatFix"/>
    <arg name="cmd_vel_out" default="robotnik_base_control/cmd_vel"/>
  </group> -->

      
    <arg name="odom_frame" default="$(arg prefix)_odom"/>
  <arg name="map_frame" default="$(arg prefix)_map"/>
  <arg name="world_frame" default="$(arg prefix)_map"/> <!--move base-->
    
<!-- 参数更改 -->
    <arg name="laser_raw_topic" default="front_laser/scan"/> 
    <arg name="imu_raw_data" default="imu/data_raw" />
    <!-- <arg name="imu_raw_data" default="imu" /> -->
    <arg name="imu_raw_mag" default="mavros/imu/mag" /> <!--default false-->
    <!-- <arg name="odom_raw_topic" default="movePlatform_node/odom" /> -->
    <arg name="odom_raw_topic" default="robotnik_base_control/odom" />
    <arg name="img1_raw" default="robot_front_ptz_camera/image_raw"/> 
    <arg name="img2_raw" default="robot_front_ptz_camera/image_raw"/> 
    <arg name="gps_raw" default="gps/NavSatFix"/>
    <arg name="cmd_vel_out" default="robotnik_base_control/cmd_vel"/>

    <arg name="base_frame" default="$(arg prefix)_base_footprint"/>
    <arg name="imuFilter_fixed_frame" default="$(arg prefix)_imu_link"/>
    <arg name="laser_box_frame" default="$(arg prefix)_front_laser_base_link"/>
    <arg name="laser_frame" default="$(arg prefix)_front_laser_link"/>
    <!-- <arg name="base_frame" default="base_footprint"/> -->

<group ns="$(arg id_robot)">

  <!-- data Fusion -->
  <!-- TODO 不同的融合方式 -->
  <include if="$(arg dataFusion)" file="$(find sxl_localization)/launch/data_fusion.launch">
      <arg name="prefix"  value="$(arg prefix)"/> 
      <arg name="config_prefix"  value="$(arg config_prefix)"/> 

      <arg name="laser_raw_topic"  value="$(arg laser_raw_topic)"/>
      <arg name="odom_raw_topic"  value="$(arg odom_raw_topic)"/>
      <arg name="imu_raw_data"  value="$(arg imu_raw_data)"/>
      <arg name="imu_raw_mag"  value="$(arg imu_raw_mag)"/>
      <arg name="gps_raw"  value="$(arg gps_raw)"/>
      <arg name="imuFilter_fixed_frame"  value="$(arg imuFilter_fixed_frame)"/>
      <arg name="laser_box_frame"  value="$(arg laser_box_frame)"/>
      
      <!-- <arg name="odom_filter_topic"  value="$(arg odom_filter_topic)"/> -->
      <arg name="imuodom_topic_pub"  value="$(arg imuodom_topic_pub)"/>
      <arg name="gpsodom_topic_pub"  value="$(arg gpsodom_topic_pub)"/>

      <arg name="laser_filtered_topic" value="$(arg laser_filtered_topic)"/>
      <arg name="base_frame"  value="$(arg base_frame)"/>
      <arg name="odom_frame"  value="$(arg odom_frame)"/> 
      <arg name="map_frame"  value="$(arg map_frame)"/> 
      <arg name="world_frame"  value="$(arg world_frame)"/> 

  </include>
  <!-- TODO location  -->

  <group if="$(arg use_static_map)" >
      <!-- Map server -->
      <node  pkg="map_server" name="map_server" type="map_server" args="$(arg map_file)">
        <param name="frame_id"  value="$(arg map_frame)"/>
        <!-- <param name="frame_id"  value="map_server_frame"/> -->
      </node>
      <!-- AMCL -->
      <include if="$(arg launch_amcl)" file="$(find sxl_localization)/launch/sxl_amcl.launch">
        <arg name="scan_topic" value="$(arg laser_filtered_topic)"/>
        <arg name="base_frame"  value="$(arg base_frame)"/>
        <arg name="odom_frame"  value="$(arg odom_frame)"/> 
        <arg name="map_frame"  value="$(arg map_frame)"/> 
        <arg name="config_prefix"  value="$(arg config_prefix)"/> 
        <!-- <arg name="map_topic"  value="map"/>  -->
      </include>
  </group>

  <group if="$(arg launch_vslam)" >
    <include file="$(find sxl_vslam)/launch/vslam_vins.launch">
      <arg name="config_prefix"  value="$(arg config_prefix)"/> 
      <!-- <arg name="img1_in" value="$(arg img1_raw)"/>
      <arg name="img2_in" value="$(arg img2_raw)"/>
      <arg name="imu_in" value="$(arg imu_raw_data)"/> -->
      <!-- <arg name="odom_frame"  value="$(arg odom_frame)"/> 
      <arg name="map_frame"  value="$(arg map_frame)"/> 
      <arg name="base_frame"  value="$(arg base_frame)"/> -->
    </include>
  </group>  
  <group if="$(arg launch_slam)" >
  <!-- SLAM: Gmapping, Cartographer, Hector, Karto, Frontier_exploration, RTAB-Map -->
    <include file="$(find sxl_localization)/launch/$(arg config_prefix)_slam_$(arg slam_methods).launch">
      <arg name="slam_scan_topic" value="$(arg laser_filtered_topic)"/>
      <arg name="config_prefix" value="$(arg config_prefix)"/>
      <arg name="odom_frame"  value="$(arg odom_frame)"/> 
      <arg name="map_frame"  value="$(arg map_frame)"/> 
      <arg name="base_frame"  value="$(arg base_frame)"/>
    </include>
  </group>  

  <!-- move_base -->
  <include file="$(find sxl_navigation)/launch/sxl_move_base.launch">
    <arg name="config_prefix"  value="$(arg config_prefix)"/>
    <arg name="world_frame" value="$(arg world_frame)"/>
    <arg name="base_frame"  value="$(arg base_frame)"/>
    <arg name="odom_frame"  value="$(arg odom_frame)"/>
    <arg name="laser_frame"  value="$(arg laser_frame)"/>

    <arg name="odom_topic"  value="$(arg odom_filter_topic)"/>
    <arg name="laser_filtered_topic" value="$(arg laser_filtered_topic)"/>

    <!-- <arg name="cmd_vel_out" value="$(arg cmd_vel_out)" /> -->
  </include>
  
  <!-- twist_mux -->
  <node pkg="twist_mux" type="twist_mux" name="twist_mux">
    <rosparam command="load" file="$(find tv_task)/config/tv_twist_mux.yaml" />
    <remap from="cmd_vel_out" to="$(arg cmd_vel_out)" />
  </node>
  <node pkg="twist_mux" type="twist_marker" name="twist_marker">
    <remap from="twist"  to="$(arg cmd_vel_out)"/>
    <remap from="marker" to="twist_marker"/>
  </node>

  <!-- rviz -->
  <!-- <group if="$(arg perRviz_open)"> 
    <node pkg="rviz" type="rviz" name="rviz" required="true"
          args="-d $(arg rvizConfig)"/>
  </group> -->
  </group> 
</launch>
